<%= gmaps4rails(@json) %>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="heatmap.js"></script>
<script type="text/javascript" src="heatmap-gmaps.js"></script>
<script type="text/javascript">
$(document).ready(function() {
Gmaps.map.callback = function(){
    // standard gmaps initialization
    var myLatlng = new google.maps.LatLng(30.3, 97.7);
    // define map properties
    var myOptions = {
      zoom: 5,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      disableDefaultUI: false,
      scrollwheel: true,
      draggable: true,
      navigationControl: true,
      mapTypeControl: true,
      scaleControl: true,
      disableDoubleClickZoom: false
    };
    // we'll use the heatmapArea 
    var map = new self.Map($("#heatmapArea")[0], myOptions);
    
    // let's create a heatmap-overlay
    // with heatmap config properties
    var heatmap = new HeatmapOverlay(map, {
        "radius":20,
        "visible":true, 
        "opacity":60
    });
    
    var testData={
		data: [{lat: 33.5363, lng:-117.044, count: 1},{lat: 33.5608, lng:-117.24, count: 1},{lat: 38, lng:-97, count: 1},{lat: 38.9358, lng:-77.1621, count: 1}]
    };
    
     google.maps.event.addListenerOnce(map, "idle", function(){
        // this is important, because if you set the data set too early, the latlng/pixel projection doesn't work
        heatmap.setDataSet(testData);
	};
};

    });

</script>

<h1>Listing crimes</h1>

<table>
  <tr>
    <th>Title</th>
    <th>Type</th>
    <th>Date of crime</th>
    <th>Latitude</th>
    <th>Longitude</th>
    <th>Street address</th>
    <th>City</th>
    <th>State</th>
    <th>Zipcode</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

<% @crimes.each do |crime| %>
  <tr>
    <td><%= crime.title %></td>
    <td><%= crime.type_of_crime %></td>
    <td><%= crime.date_of_crime %></td>
    <td><%= crime.latitude %></td>
    <td><%= crime.longitude %></td>
    <td><%= crime.street_address %></td>
    <td><%= crime.city %></td>
    <td><%= crime.state %></td>
    <td><%= crime.zipcode %></td>
    <td><%= link_to 'Show', crime %></td>
    <td><%= link_to 'Edit', edit_crime_path(crime) %></td>
    <td><%= link_to 'Destroy', crime, method: :delete, data: { confirm: 'Are you sure?' } %></td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New Crime', new_crime_path %>
